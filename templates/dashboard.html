<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PM2.5 Prediction Dashboard</title>

    <!-- CSS Libraries -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <style>
      .glass-effect {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .card-hover {
        transition: all 0.3s ease;
      }

      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }

      .pulse-animation {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .loading-spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 2s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
      }

      .status-good {
        background-color: #10b981;
      }
      .status-moderate {
        background-color: #f59e0b;
      }
      .status-unhealthy {
        background-color: #ef4444;
      }
      .status-hazardous {
        background-color: #7c2d12;
      }

      .sidebar {
        transition: transform 0.3s ease;
      }

      .sidebar-hidden {
        transform: translateX(-100%);
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans">
    <!-- Navigation Header -->
    <nav class="gradient-bg text-white shadow-lg">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center">
            <button
              id="sidebarToggle"
              class="p-2 rounded-md hover:bg-white hover:bg-opacity-20"
            >
              <i class="fas fa-bars"></i>
            </button>
            <h1 class="ml-4 text-xl font-bold">PM2.5 Prediction Dashboard</h1>
          </div>
          <div class="flex items-center space-x-4">
            <div id="connectionStatus" class="flex items-center">
              <span class="status-indicator status-good"></span>
              <span class="text-sm">Connected</span>
            </div>
            <button
              id="refreshData"
              class="p-2 rounded-md hover:bg-white hover:bg-opacity-20"
            >
              <i class="fas fa-sync-alt"></i>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <div class="flex">
      <!-- Sidebar -->
      <div
        id="sidebar"
        class="sidebar fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg mt-16"
      >
        <div class="p-6">
          <h2 class="text-lg font-semibold mb-4">Navigation</h2>
          <nav class="space-y-2">
            <a
              href="#overview"
              class="nav-link block px-4 py-2 rounded-md hover:bg-gray-100 transition-colors bg-blue-100 text-blue-700"
            >
              <i class="fas fa-tachometer-alt mr-2"></i> Overview
            </a>
            <a
              href="#data-upload"
              class="nav-link block px-4 py-2 rounded-md hover:bg-gray-100 transition-colors"
            >
              <i class="fas fa-upload mr-2"></i> Data Upload
            </a>
            <a
              href="#model-training"
              class="nav-link block px-4 py-2 rounded-md hover:bg-gray-100 transition-colors"
            >
              <i class="fas fa-brain mr-2"></i> Model Training
            </a>
            <a
              href="#predictions"
              class="nav-link block px-4 py-2 rounded-md hover:bg-gray-100 transition-colors"
            >
              <i class="fas fa-chart-line mr-2"></i> Predictions
            </a>
            <a
              href="#analytics"
              class="nav-link block px-4 py-2 rounded-md hover:bg-gray-100 transition-colors"
            >
              <i class="fas fa-analytics mr-2"></i> Analytics
            </a>
            <a
              href="#realtime"
              class="nav-link block px-4 py-2 rounded-md hover:bg-gray-100 transition-colors"
            >
              <i class="fas fa-broadcast-tower mr-2"></i> Real-time
            </a>
          </nav>
        </div>
      </div>

      <!-- Main Content -->
      <div
        id="mainContent"
        class="flex-1 ml-64 p-6 transition-all duration-300"
      >
        <!-- Overview Section -->
        <section id="overview" class="section-content">
          <h2 class="text-2xl font-bold mb-6">Dashboard Overview</h2>

          <!-- Key Metrics Cards -->
          <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"
          >
            <div class="bg-white rounded-lg shadow-md p-6 card-hover">
              <div class="flex items-center">
                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                  <i class="fas fa-wind text-xl"></i>
                </div>
                <div class="ml-4">
                  <p class="text-sm text-gray-600">Current PM2.5</p>
                  <p id="currentPM25" class="text-2xl font-semibold">
                    42.5 μg/m³
                  </p>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 card-hover">
              <div class="flex items-center">
                <div class="p-3 rounded-full bg-green-100 text-green-600">
                  <i class="fas fa-chart-line text-xl"></i>
                </div>
                <div class="ml-4">
                  <p class="text-sm text-gray-600">Model Accuracy</p>
                  <p id="modelAccuracy" class="text-2xl font-semibold">87.3%</p>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 card-hover">
              <div class="flex items-center">
                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                  <i class="fas fa-database text-xl"></i>
                </div>
                <div class="ml-4">
                  <p class="text-sm text-gray-600">Data Points</p>
                  <p id="dataPoints" class="text-2xl font-semibold">1,245</p>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 card-hover">
              <div class="flex items-center">
                <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                  <i class="fas fa-clock text-xl"></i>
                </div>
                <div class="ml-4">
                  <p class="text-sm text-gray-600">Last Update</p>
                  <p id="lastUpdate" class="text-sm font-semibold">2 min ago</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Charts Row -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-semibold mb-4">PM2.5 Trend</h3>
              <canvas id="pm25TrendChart" width="400" height="200"></canvas>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-semibold mb-4">Air Quality Status</h3>
              <div id="aqiGauge" class="flex items-center justify-center h-48">
                <div class="relative">
                  <canvas id="aqiCanvas" width="200" height="200"></canvas>
                  <div
                    class="absolute inset-0 flex items-center justify-center"
                  >
                    <div class="text-center">
                      <div id="aqiValue" class="text-3xl font-bold">72</div>
                      <div id="aqiCategory" class="text-sm text-gray-600">
                        Moderate
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Data Upload Section -->
        <section id="data-upload" class="section-content hidden">
          <h2 class="text-2xl font-bold mb-6">Data Upload & Processing</h2>

          <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h3 class="text-lg font-semibold mb-4">Upload CSV File</h3>

            <div
              class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center"
            >
              <div id="dropZone" class="cursor-pointer">
                <i
                  class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"
                ></i>
                <p class="text-lg mb-2">
                  Drop your CSV file here or click to browse
                </p>
                <p class="text-sm text-gray-500">
                  Supported format: CSV with datetime, pm2.5, temperature,
                  humidity columns
                </p>
                <input
                  type="file"
                  id="fileInput"
                  accept=".csv"
                  class="hidden"
                />
              </div>
            </div>

            <div id="uploadProgress" class="hidden mt-4">
              <div class="flex items-center">
                <div class="loading-spinner mr-3"></div>
                <span>Processing file...</span>
              </div>
            </div>

            <div id="uploadResult" class="hidden mt-4"></div>
          </div>

          <!-- Data Summary -->
          <div id="dataSummary" class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-lg font-semibold mb-4">Data Summary</h3>
            <div id="summaryContent">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-gray-50 p-4 rounded-lg">
                  <h4 class="font-medium mb-2">Total Records</h4>
                  <p class="text-2xl font-bold text-blue-600">1,245</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                  <h4 class="font-medium mb-2">Date Range</h4>
                  <p class="text-sm">Jan 2024 - May 2024</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                  <h4 class="font-medium mb-2">Data Quality</h4>
                  <p class="text-sm text-green-600">94% Complete</p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Model Training Section -->
        <section id="model-training" class="section-content hidden">
          <h2 class="text-2xl font-bold mb-6">Model Training</h2>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-semibold mb-4">Train New Model</h3>

              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Model Type</label
                >
                <select
                  id="modelTypeSelect"
                  class="w-full p-2 border border-gray-300 rounded-md"
                >
                  <option value="RandomForest">Random Forest</option>
                  <option value="GradientBoosting">Gradient Boosting</option>
                  <option value="LinearRegression">Linear Regression</option>
                  <option value="SVR">Support Vector Regression</option>
                </select>
              </div>

              <button
                id="trainModelBtn"
                class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors"
              >
                <i class="fas fa-brain mr-2"></i>Train Model
              </button>

              <div id="trainingProgress" class="hidden mt-4">
                <div class="flex items-center">
                  <div class="loading-spinner mr-3"></div>
                  <span>Training model...</span>
                </div>
              </div>

              <div id="trainingResult" class="hidden mt-4"></div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-semibold mb-4">
                Model Performance History
              </h3>
              <div id="performanceHistory">
                <div class="space-y-3">
                  <div
                    class="flex justify-between items-center p-3 bg-gray-50 rounded"
                  >
                    <div>
                      <p class="font-medium">Random Forest</p>
                      <p class="text-sm text-gray-600">Trained 2 hours ago</p>
                    </div>
                    <div class="text-right">
                      <p class="text-lg font-bold text-green-600">87.3%</p>
                      <p class="text-xs text-gray-500">Accuracy</p>
                    </div>
                  </div>
                  <div
                    class="flex justify-between items-center p-3 bg-gray-50 rounded"
                  >
                    <div>
                      <p class="font-medium">Gradient Boosting</p>
                      <p class="text-sm text-gray-600">Trained yesterday</p>
                    </div>
                    <div class="text-right">
                      <p class="text-lg font-bold text-blue-600">85.1%</p>
                      <p class="text-xs text-gray-500">Accuracy</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Feature Importance -->
          <div
            id="featureImportance"
            class="bg-white rounded-lg shadow-md p-6 mt-6"
          >
            <h3 class="text-lg font-semibold mb-4">Feature Importance</h3>
            <canvas id="featureChart" width="400" height="200"></canvas>
          </div>
        </section>

        <!-- Predictions Section -->
        <section id="predictions" class="section-content hidden">
          <h2 class="text-2xl font-bold mb-6">Make Predictions</h2>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-semibold mb-4">Input Features</h3>

              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Temperature (°C)</label
                  >
                  <input
                    type="number"
                    id="tempInput"
                    class="w-full p-2 border border-gray-300 rounded-md"
                    placeholder="25.0"
                    step="0.1"
                    value="25.0"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Humidity (%)</label
                  >
                  <input
                    type="number"
                    id="humidityInput"
                    class="w-full p-2 border border-gray-300 rounded-md"
                    placeholder="60.0"
                    step="0.1"
                    value="60.0"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Hour (0-23)</label
                  >
                  <input
                    type="number"
                    id="hourInput"
                    class="w-full p-2 border border-gray-300 rounded-md"
                    placeholder="14"
                    min="0"
                    max="23"
                    value="14"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Weekend?</label
                  >
                  <select
                    id="weekendSelect"
                    class="w-full p-2 border border-gray-300 rounded-md"
                  >
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                  </select>
                </div>
              </div>

              <button
                id="predictBtn"
                class="w-full mt-4 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors"
              >
                <i class="fas fa-magic mr-2"></i>Make Prediction
              </button>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-semibold mb-4">Prediction Result</h3>

              <div id="predictionResult" class="text-center p-8">
                <div class="text-gray-400">
                  <i class="fas fa-chart-line text-4xl mb-4"></i>
                  <p>Enter features and click "Make Prediction"</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Batch Predictions -->
          <div class="bg-white rounded-lg shadow-md p-6 mt-6">
            <h3 class="text-lg font-semibold mb-4">Scenario Analysis</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <button
                id="scenarioLow"
                class="p-4 border border-gray-300 rounded-md hover:bg-gray-50"
              >
                <i class="fas fa-leaf text-green-500 mb-2 text-2xl"></i>
                <p class="font-medium">Low Pollution</p>
                <p class="text-sm text-gray-600">Cool, high humidity</p>
              </button>

              <button
                id="scenarioMod"
                class="p-4 border border-gray-300 rounded-md hover:bg-gray-50"
              >
                <i class="fas fa-city text-yellow-500 mb-2 text-2xl"></i>
                <p class="font-medium">Moderate</p>
                <p class="text-sm text-gray-600">Average conditions</p>
              </button>

              <button
                id="scenarioHigh"
                class="p-4 border border-gray-300 rounded-md hover:bg-gray-50"
              >
                <i class="fas fa-industry text-red-500 mb-2 text-2xl"></i>
                <p class="font-medium">High Pollution</p>
                <p class="text-sm text-gray-600">Hot, low humidity</p>
              </button>
            </div>
          </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics" class="section-content hidden">
          <h2 class="text-2xl font-bold mb-6">Advanced Analytics</h2>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-semibold mb-4">Correlation Matrix</h3>
              <canvas id="correlationChart" width="400" height="400"></canvas>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-semibold mb-4">Distribution Analysis</h3>
              <canvas id="distributionChart" width="400" height="300"></canvas>
            </div>
          </div>

          <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-lg font-semibold mb-4">
              Time Series Decomposition
            </h3>
            <canvas id="decompositionChart" width="800" height="400"></canvas>
          </div>
        </section>

        <!-- Real-time Section -->
        <section id="realtime" class="section-content hidden">
          <h2 class="text-2xl font-bold mb-6">Real-time Monitoring</h2>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-semibold mb-4">Live Data Stream</h3>
              <div id="liveDataStatus" class="flex items-center mb-4">
                <span
                  class="status-indicator status-good pulse-animation"
                ></span>
                <span>Streaming Active</span>
              </div>

              <div class="space-y-2" id="liveDataValues">
                <div class="flex justify-between">
                  <span>PM2.5:</span>
                  <span id="livePM25" class="font-bold">42.5 μg/m³</span>
                </div>
                <div class="flex justify-between">
                  <span>Temperature:</span>
                  <span id="liveTemp" class="font-bold">25.3°C</span>
                </div>
                <div class="flex justify-between">
                  <span>Humidity:</span>
                  <span id="liveHumidity" class="font-bold">62%</span>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-semibold mb-4">Alerts & Notifications</h3>
              <div id="alertsContainer" class="space-y-2">
                <div class="bg-yellow-50 border border-yellow-200 rounded p-3">
                  <div class="flex items-center">
                    <i
                      class="fas fa-exclamation-triangle text-yellow-500 mr-2"
                    ></i>
                    <div>
                      <p class="font-medium text-yellow-800">Moderate Alert</p>
                      <p class="text-sm text-yellow-600">
                        PM2.5 levels elevated
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-semibold mb-4">Quick Actions</h3>
              <div class="space-y-2">
                <button
                  id="startMonitoring"
                  class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700"
                >
                  <i class="fas fa-play mr-2"></i>Start Monitoring
                </button>
                <button
                  id="stopMonitoring"
                  class="w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700"
                >
                  <i class="fas fa-stop mr-2"></i>Stop Monitoring
                </button>
                <button
                  id="exportData"
                  class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700"
                >
                  <i class="fas fa-download mr-2"></i>Export Data
                </button>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-lg font-semibold mb-4">Real-time Chart</h3>
            <canvas id="realtimeChart" width="800" height="300"></canvas>
          </div>
        </section>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div
      id="loadingOverlay"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
    >
      <div class="bg-white rounded-lg p-8 text-center">
        <div class="loading-spinner mx-auto mb-4"></div>
        <p id="loadingText">Loading...</p>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="fixed top-20 right-6 z-50 space-y-2"></div>

    <script>
      // Dashboard JavaScript
      class PM25Dashboard {
        constructor() {
          this.apiBase = "";
          this.charts = {};
          this.realtimeInterval = null;
          this.currentSection = "overview";
          this.sampleData = this.generateSampleData();

          this.init();
        }

        init() {
          this.setupEventListeners();
          this.initializeCharts();
          this.loadInitialData();
          this.checkServerConnection();
        }

        generateSampleData() {
          const data = [];
          const now = new Date();
          for (let i = 23; i >= 0; i--) {
            const date = new Date(now.getTime() - i * 60 * 60 * 1000);
            data.push({
              timestamp: date,
              pm25: Math.random() * 100 + 20,
              temperature: Math.random() * 15 + 20,
              humidity: Math.random() * 40 + 40,
            });
          }
          return data;
        }

        setupEventListeners() {
          // Sidebar toggle
          document
            .getElementById("sidebarToggle")
            .addEventListener("click", () => {
              const sidebar = document.getElementById("sidebar");
              const mainContent = document.getElementById("mainContent");

              sidebar.classList.toggle("sidebar-hidden");
              if (sidebar.classList.contains("sidebar-hidden")) {
                mainContent.classList.remove("ml-64");
                mainContent.classList.add("ml-0");
              } else {
                mainContent.classList.remove("ml-0");
                mainContent.classList.add("ml-64");
              }
            });

          // Navigation links
          document.querySelectorAll(".nav-link").forEach((link) => {
            link.addEventListener("click", (e) => {
              e.preventDefault();
              const section = link.getAttribute("href").substring(1);
              this.showSection(section);
            });
          });

          // File upload
          const dropZone = document.getElementById("dropZone");
          const fileInput = document.getElementById("fileInput");

          dropZone.addEventListener("click", () => fileInput.click());
          dropZone.addEventListener("dragover", (e) => {
            e.preventDefault();
            dropZone.classList.add("border-blue-500", "bg-blue-50");
          });
          dropZone.addEventListener("dragleave", () => {
            dropZone.classList.remove("border-blue-500", "bg-blue-50");
          });
          dropZone.addEventListener("drop", (e) => {
            e.preventDefault();
            dropZone.classList.remove("border-blue-500", "bg-blue-50");
            const files = e.dataTransfer.files;
            if (files.length > 0) {
              this.handleFileUpload(files[0]);
            }
          });

          fileInput.addEventListener("change", (e) => {
            if (e.target.files.length > 0) {
              this.handleFileUpload(e.target.files[0]);
            }
          });

          // Model training
          document
            .getElementById("trainModelBtn")
            .addEventListener("click", () => {
              this.trainModel();
            });

          // Prediction button
          document
            .getElementById("predictBtn")
            .addEventListener("click", () => {
              this.makePrediction();
            });

          // Real-time toggle
          document
            .getElementById("realtimeToggle")
            .addEventListener("change", (e) => {
              if (e.target.checked) {
                this.startRealtime();
              } else {
                this.stopRealtime();
              }
            });

          // Export data button
          document
            .getElementById("exportDataBtn")
            .addEventListener("click", () => {
              this.exportData();
            });

          // Settings form
          document
            .getElementById("settingsForm")
            .addEventListener("submit", (e) => {
              e.preventDefault();
              this.saveSettings();
            });
        }

        showSection(sectionName) {
          // Hide all sections
          document.querySelectorAll(".section").forEach((section) => {
            section.style.display = "none";
          });

          // Show selected section
          const targetSection = document.getElementById(sectionName);
          if (targetSection) {
            targetSection.style.display = "block";
            this.currentSection = sectionName;
          }

          // Update navigation
          document.querySelectorAll(".nav-link").forEach((link) => {
            link.classList.remove(
              "bg-blue-50",
              "text-blue-600",
              "border-r-2",
              "border-blue-600"
            );
          });

          const activeLink = document.querySelector(`[href="#${sectionName}"]`);
          if (activeLink) {
            activeLink.classList.add(
              "bg-blue-50",
              "text-blue-600",
              "border-r-2",
              "border-blue-600"
            );
          }

          // Load section-specific data
          this.loadSectionData(sectionName);
        }

        loadSectionData(section) {
          switch (section) {
            case "overview":
              this.updateOverviewStats();
              break;
            case "realtime":
              this.updateRealtimeCharts();
              break;
            case "analytics":
              this.updateAnalyticsCharts();
              break;
            case "ml":
              this.updateMLSection();
              break;
          }
        }

        initializeCharts() {
          // Overview chart
          const overviewCtx = document
            .getElementById("overviewChart")
            ?.getContext("2d");
          if (overviewCtx) {
            this.charts.overview = new Chart(overviewCtx, {
              type: "line",
              data: {
                labels: [],
                datasets: [
                  {
                    label: "PM2.5 (μg/m³)",
                    data: [],
                    borderColor: "#3B82F6",
                    backgroundColor: "rgba(59, 130, 246, 0.1)",
                    tension: 0.4,
                    fill: true,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                  y: {
                    beginAtZero: true,
                    title: { display: true, text: "PM2.5 (μg/m³)" },
                  },
                },
              },
            });
          }

          // Real-time chart
          const realtimeCtx = document
            .getElementById("realtimeChart")
            ?.getContext("2d");
          if (realtimeCtx) {
            this.charts.realtime = new Chart(realtimeCtx, {
              type: "line",
              data: {
                labels: [],
                datasets: [
                  {
                    label: "PM2.5",
                    data: [],
                    borderColor: "#EF4444",
                    backgroundColor: "rgba(239, 68, 68, 0.1)",
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: { duration: 0 },
                scales: { y: { beginAtZero: true } },
              },
            });
          }

          // Analytics comparison chart
          const analyticsCtx = document
            .getElementById("analyticsChart")
            ?.getContext("2d");
          if (analyticsCtx) {
            this.charts.analytics = new Chart(analyticsCtx, {
              type: "bar",
              data: {
                labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
                datasets: [
                  {
                    label: "Average PM2.5",
                    data: [45, 52, 38, 41, 47, 35],
                    backgroundColor: "rgba(16, 185, 129, 0.8)",
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
              },
            });
          }
        }

        updateOverviewStats() {
          const latestData = this.sampleData[this.sampleData.length - 1];
          const currentPM25 = latestData.pm25.toFixed(1);

          document.getElementById("currentPM25").textContent = currentPM25;
          document.getElementById("aqiStatus").textContent =
            this.getAQIStatus(currentPM25);
          document.getElementById("lastUpdated").textContent =
            new Date().toLocaleTimeString();

          // Update overview chart
          if (this.charts.overview) {
            this.charts.overview.data.labels = this.sampleData.map((d) =>
              d.timestamp.toLocaleTimeString("en-US", {
                hour: "2-digit",
                minute: "2-digit",
              })
            );
            this.charts.overview.data.datasets[0].data = this.sampleData.map(
              (d) => d.pm25
            );
            this.charts.overview.update();
          }
        }

        getAQIStatus(pm25) {
          if (pm25 <= 12) return "Good";
          if (pm25 <= 35.4) return "Moderate";
          if (pm25 <= 55.4) return "Unhealthy for Sensitive";
          if (pm25 <= 150.4) return "Unhealthy";
          if (pm25 <= 250.4) return "Very Unhealthy";
          return "Hazardous";
        }

        updateRealtimeCharts() {
          if (!this.charts.realtime) return;

          const now = new Date();
          const newData = {
            timestamp: now,
            pm25: Math.random() * 100 + 20,
          };

          this.charts.realtime.data.labels.push(now.toLocaleTimeString());
          this.charts.realtime.data.datasets[0].data.push(newData.pm25);

          // Keep only last 20 points
          if (this.charts.realtime.data.labels.length > 20) {
            this.charts.realtime.data.labels.shift();
            this.charts.realtime.data.datasets[0].data.shift();
          }

          this.charts.realtime.update("none");
        }

        updateAnalyticsCharts() {
          // Update analytics charts with processed data
          if (this.charts.analytics) {
            // Simulate monthly averages
            const monthlyData = [45, 52, 38, 41, 47, 35];
            this.charts.analytics.data.datasets[0].data = monthlyData;
            this.charts.analytics.update();
          }
        }

        updateMLSection() {
          // Update ML prediction section
          document.getElementById("modelAccuracy").textContent = "87.5%";
          document.getElementById("predictionConfidence").textContent = "92.3%";
        }

        handleFileUpload(file) {
          if (!file.type.includes("csv") && !file.type.includes("json")) {
            this.showToast("Please upload a CSV or JSON file", "error");
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              let data;
              if (file.type.includes("csv")) {
                data = this.parseCSV(e.target.result);
              } else {
                data = JSON.parse(e.target.result);
              }

              this.processUploadedData(data);
              this.showToast("File uploaded successfully", "success");
            } catch (error) {
              this.showToast(
                "Error processing file: " + error.message,
                "error"
              );
            }
          };

          reader.readAsText(file);
        }

        parseCSV(csvText) {
          const lines = csvText.split("\n");
          const headers = lines[0].split(",").map((h) => h.trim());
          const data = [];

          for (let i = 1; i < lines.length; i++) {
            if (lines[i].trim()) {
              const values = lines[i].split(",");
              const row = {};
              headers.forEach((header, index) => {
                row[header] = values[index]?.trim();
              });
              data.push(row);
            }
          }

          return data;
        }

        processUploadedData(data) {
          // Process and validate uploaded data
          document.getElementById("uploadStatus").innerHTML = `
            <div class="text-green-600">
                <i class="fas fa-check-circle mr-2"></i>
                Successfully processed ${data.length} records
            </div>
        `;

          // Update charts with new data if applicable
          this.updateChartsWithNewData(data);
        }

        updateChartsWithNewData(data) {
          // Update existing charts with uploaded data
          if (data.length > 0 && this.charts.overview) {
            // Assuming data has timestamp and pm25 fields
            const chartData = data.slice(-24); // Last 24 records
            this.charts.overview.data.labels = chartData.map(
              (d, i) => `Point ${i + 1}`
            );
            this.charts.overview.data.datasets[0].data = chartData.map(
              (d) => parseFloat(d.pm25) || 0
            );
            this.charts.overview.update();
          }
        }

        trainModel() {
          this.showToast("Starting model training...", "info");

          // Simulate model training
          const progressBar = document.getElementById("trainingProgress");
          const statusText = document.getElementById("trainingStatus");

          progressBar.style.width = "0%";
          statusText.textContent = "Initializing...";

          let progress = 0;
          const interval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress >= 100) {
              progress = 100;
              clearInterval(interval);
              statusText.textContent = "Training completed successfully!";
              this.showToast("Model training completed", "success");
              document.getElementById("modelAccuracy").textContent = "89.2%";
            } else {
              statusText.textContent = `Training... ${Math.round(progress)}%`;
            }
            progressBar.style.width = progress + "%";
          }, 500);
        }

        makePrediction() {
          const inputData = {
            temperature:
              parseFloat(document.getElementById("tempInput").value) || 25,
            humidity:
              parseFloat(document.getElementById("humidityInput").value) || 60,
            pressure:
              parseFloat(document.getElementById("pressureInput").value) ||
              1013,
          };

          // Simulate prediction
          const predictedPM25 = (
            inputData.temperature * 1.2 +
            inputData.humidity * 0.8 +
            Math.random() * 20
          ).toFixed(1);
          const confidence = (85 + Math.random() * 10).toFixed(1);

          document.getElementById("predictionResult").innerHTML = `
            <div class="bg-blue-50 p-4 rounded-lg">
                <h4 class="font-semibold text-blue-800">Prediction Result</h4>
                <p class="text-2xl font-bold text-blue-600">${predictedPM25} μg/m³</p>
                <p class="text-sm text-gray-600">Confidence: ${confidence}%</p>
            </div>
        `;

          this.showToast("Prediction generated successfully", "success");
        }

        startRealtime() {
          this.realtimeInterval = setInterval(() => {
            this.updateRealtimeCharts();
            this.updateConnectionStatus(true);
          }, 2000);

          this.showToast("Real-time monitoring started", "success");
        }

        stopRealtime() {
          if (this.realtimeInterval) {
            clearInterval(this.realtimeInterval);
            this.realtimeInterval = null;
          }

          this.updateConnectionStatus(false);
          this.showToast("Real-time monitoring stopped", "info");
        }

        updateConnectionStatus(connected) {
          const statusEl = document.getElementById("connectionStatus");
          if (connected) {
            statusEl.innerHTML = `
                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                <span class="text-sm text-gray-600">Connected</span>
            `;
          } else {
            statusEl.innerHTML = `
                <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                <span class="text-sm text-gray-600">Disconnected</span>
            `;
          }
        }

        exportData() {
          const data = JSON.stringify(this.sampleData, null, 2);
          const blob = new Blob([data], { type: "application/json" });
          const url = URL.createObjectURL(blob);

          const a = document.createElement("a");
          a.href = url;
          a.download = `pm25_data_${
            new Date().toISOString().split("T")[0]
          }.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          this.showToast("Data exported successfully", "success");
        }

        saveSettings() {
          const settings = {
            apiEndpoint: document.getElementById("apiEndpoint").value,
            updateInterval: parseInt(
              document.getElementById("updateInterval").value
            ),
            alertThreshold: parseFloat(
              document.getElementById("alertThreshold").value
            ),
          };

          // Save to memory (in a real app, this would go to localStorage or server)
          this.settings = settings;
          this.showToast("Settings saved successfully", "success");
        }

        loadInitialData() {
          this.updateOverviewStats();
          this.showSection("overview");
        }

        checkServerConnection() {
          // Simulate server connection check
          setTimeout(() => {
            this.updateConnectionStatus(false);
          }, 1000);
        }

        showToast(message, type = "info") {
          const toastContainer = document.getElementById("toastContainer");
          const toast = document.createElement("div");

          const bgColor =
            {
              success: "bg-green-500",
              error: "bg-red-500",
              warning: "bg-yellow-500",
              info: "bg-blue-500",
            }[type] || "bg-blue-500";

          toast.className = `${bgColor} text-white px-4 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full`;
          toast.innerHTML = `
            <div class="flex items-center justify-between">
                <span>${message}</span>
                <button class="ml-4 text-white hover:text-gray-200" onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;

          toastContainer.appendChild(toast);

          // Animate in
          setTimeout(() => {
            toast.classList.remove("translate-x-full");
          }, 100);

          // Auto remove after 5 seconds
          setTimeout(() => {
            toast.classList.add("translate-x-full");
            setTimeout(() => {
              if (toast.parentElement) {
                toast.parentElement.removeChild(toast);
              }
            }, 300);
          }, 5000);
        }
      }

      // Initialize dashboard when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        window.dashboard = new PM25Dashboard();
      });
    </script>
  </body>
</html>
